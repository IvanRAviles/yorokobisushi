<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ordenar – Yorokobi Sushi</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>

<header class="top">
  <img src="assets/logo.png" alt="Yorokobi Sushi"/>
  <h1>Yorokobi Sushi</h1>
  <p>Desde 2017</p>
</header>

<main class="grid">

<section id="menu">
  <h2>Menú</h2>
  <input id="search" placeholder="Buscar en esta sección…"/>
  <div id="items"></div>
</section>

<aside class="card">
  <h3>Sucursal</h3>
  <select id="loc"></select>

  <h3>Tu pedido</h3>
  <ul id="orderList"></ul>

  <label>Nombre</label>
  <input id="custName" placeholder="Tu nombre"/>

  <label>Teléfono</label>
  <input id="custPhone" inputmode="numeric" placeholder="Ej. 6861234567"/>

  <label>Servicio</label>
  <select id="serviceType">
    <option value="">Selecciona servicio</option>
    <option value="Para llevar">Para llevar</option>
    <option value="Comer aquí">Comer aquí</option>
  </select>

  <label>Pago</label>
  <select id="payMethod">
    <option value="">Selecciona método de pago</option>
    <option value="Efectivo">Efectivo</option>
    <option value="Tarjeta">Tarjeta</option>
  </select>

  <button class="waBtn" id="wa">Ordenar por WhatsApp</button>
</aside>

</main>

<script>
const LOCATIONS = [
  { id:"carranza", name:"Sucursal Carranza", wa:"https://wa.me/526861111111" },
  { id:"anahuac", name:"Sucursal Anáhuac", wa:"https://wa.me/526862222222" },
  { id:"industrial", name:"Sucursal Industrial", wa:"https://wa.me/526863333333" }
];

const ORDER = [];
const params = new URLSearchParams(location.search);
const presetLoc = params.get("loc");

const locSel = document.getElementById("loc");
LOCATIONS.forEach(l=>{
  const o=document.createElement("option");
  o.value=l.id; o.textContent=l.name;
  locSel.appendChild(o);
});
locSel.value = presetLoc || LOCATIONS[0].id;

async function loadMenu(){
  const res = await fetch("/assets/data/menu.json",{cache:"no-store"});
  const data = await res.json();
  const itemsEl = document.getElementById("items");

  data.sections.forEach(sec=>{
    const h=document.createElement("h3");
    h.textContent=sec.title;
    itemsEl.appendChild(h);

    sec.items.forEach(it=>{
      const d=document.createElement("div");
      d.className="item";
      d.innerHTML=`
        <strong>${it.name}</strong>
        <div>${it.price || ""}</div>
        <button class="addBtn">Agregar</button>
      `;
      d.querySelector("button").onclick=()=>{
        ORDER.push(it.name);
        renderOrder();
      };
      itemsEl.appendChild(d);
    });
  });
}

function renderOrder(){
  const ul=document.getElementById("orderList");
  ul.innerHTML="";
  ORDER.forEach(i=>{
    const li=document.createElement("li");
    li.textContent=i;
    ul.appendChild(li);
  });
}

document.getElementById("wa").onclick=()=>{
  const loc = LOCATIONS.find(l=>l.id===locSel.value);
  const msg =
`Hola, quiero hacer un pedido.

Pedido:
- ${ORDER.join("\n- ")}

Nombre: ${custName.value}
Teléfono: ${custPhone.value}
Servicio: ${serviceType.value}
Pago: ${payMethod.value}
`;
  window.open(loc.wa+"?text="+encodeURIComponent(msg));
};

loadMenu();
</script>

</body>
</html>
